/*! roadmap.js v0.0.1 - MIT license 
2015-07-01 - Florent Solt */
!function(){function a(a){switch(a.type){case"people":return a.taskGroup;case"task":return a.group;case"group":return a.name}}function b(b){var e=c(a(b));d===e?(d3.selectAll(".item").style("opacity",1),d=!1):(d3.selectAll(".item").style("opacity",.2),d3.selectAll("."+e).style("opacity",1),d=e)}function c(a){return"_"+a.toLowerCase().replace(/[^a-z0-9]+/g,function(){return"-"})}var d=!1,e=function(){var a=d3.scale.category20();d3.selectAll("div.roadmap").each(function(){var b=[],c=[],d={};lines=(this.textContent||this.innerHTML||"").split("\n");for(var e,g=0;e=lines[g],g<lines.length;g++)e=e.replace(/^\s+|\s+$/g,""),d.name||d.group?d.from||d.to?""===e?""===e&&d.name&&(b.push(d),d={}):c.push({type:"people",group:e,from:d.from,to:d.to,name:d.group+" â€” "+d.name,taskGroup:d.group,color:a(d.group)}):(texts=e.replace(/[^0-9\-\/]+/," ").split(" "),d.from=texts[0],d.to=texts[1]):(texts=e.split(","),d.type="task",d.group=texts[0],d.name=texts.slice(1).join(","),d.color=a(d.group));if(b.length>0){this.innerHTML="";var h=f(this,b,{});c.sort(function(a,b){return a.group>b.group?1:-1}),c.length>0&&f(this,c,h)}})},f=function(d,e,f){var g=d3.time.format("%Y-%m-%d"),h=20,i=h+4,j=20,k=e.length*i+j+40,l=d.clientWidth,m=d3.select(d).append("svg").attr("width",l).attr("height",k).attr("style","overflow: visible");e.sort(function(a,b){return a.group===b.group?g.parse(a.from)>g.parse(b.from)?1:-1:a.group>b.group?1:-1});for(var n=[],o=0,p=0;p<e.length;p++){for(var q=0,r=!1;q<n.length&&!r;)r=n[q].name===e[p].group,q++;if(!r){var s=0;for(q=0;q<e.length;)e[q].group==e[p].group&&s++,q++;n.push({type:"group",name:e[p].group,count:s,previous:o}),o+=s}}m.append("g").selectAll("rect").data(n).enter().append("rect").attr("rx",3).attr("ry",3).attr("x",0).attr("y",function(a){return a.previous*i+j}).attr("width",function(){return l}).attr("height",function(a){return a.count*i-4}).attr("stroke","none").attr("fill","#999").attr("fill-opacity",.1);var t=m.append("g").selectAll("text").data(n).enter().append("text").text(function(a){return a.name}).attr("x",10).attr("y",function(a){return a.count*i/2+a.previous*i+j}).attr("font-size",11).attr("text-anchor","start").attr("text-height",14).attr("fill","#000"),u=f.sidePadding||t[0].parentNode.getBBox().width+15,v=d3.time.scale().clamp(!0).domain([d3.min(e,function(a){return g.parse(a.from)}),d3.max(e,function(a){var b=g.parse(a.to);return b.setHours(b.getHours()+24)})]).range([0,l-u-15]),w=d3.svg.axis().scale(v).orient("bottom").ticks(d3.time.monday).tickSize(-k+j+20,0,0).tickFormat(d3.time.format("%b %d")),x=m.append("g").attr("transform","translate("+u+", "+(k-30)+")").call(w),y=new Date;y>v.domain()[0]&&y<v.domain()[1]&&(x.append("line").attr("x1",v(y)).attr("y1",0).attr("x2",v(y)).attr("y2",-k+j+20).attr("class","now"),x.selectAll(".now").attr("stroke","red").attr("opacity",.5).attr("stroke-dasharray","2,2").attr("shape-rendering","crispEdges")),x.selectAll("text").style("text-anchor","middle").attr("fill","#000").attr("stroke","none").attr("font-size",10).attr("dy","1em"),x.selectAll(".tick line").attr("stroke","#dddddd").attr("shape-rendering","crispEdges");var z=m.append("g").selectAll("rect").data(e).enter();z.append("rect").attr("class",function(b){return"item "+c(a(b))}).attr("rx",3).attr("ry",3).attr("x",function(a){return v(g.parse(a.from))+u}).attr("y",function(a,b){return b*i+j}).attr("width",function(a){var b=g.parse(a.to);return b.setHours(b.getHours()+24),v(b)-v(g.parse(a.from))}).attr("height",h).attr("stroke","none").attr("fill",function(a){return a.color}).attr("fill-opacity",.5).on("mouseover",function(){d3.select(this).style({cursor:"pointer"})}).on("click",b),z.append("text").attr("class",function(b){return"item "+c(a(b))}).text(function(a){return a.name}).attr("x",function(a){return(v(g.parse(a.to))-v(g.parse(a.from)))/2+v(g.parse(a.from))+u}).attr("y",function(a,b){return b*i+14+j}).attr("font-size",11).attr("text-anchor","middle").attr("text-height",h).attr("fill","#000").style("pointer-events","none");var A=m.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0).style("stroke","black").style("stroke-width","1px").style("stroke-dasharray","2,2").style("shape-rendering","crispEdges").style("pointer-events","none").style("display","none"),B=m.append("rect").attr("rx",3).attr("ry",3).attr("width",50).attr("height",h).attr("stroke","none").attr("fill","black").attr("fill-opacity",.8).style("display","none"),C=m.append("text").attr("font-size",11).attr("font-weight","bold").attr("text-anchor","middle").attr("text-height",h).attr("fill","white").style("display","none"),D=40;return m.on("mousemove",function(){var a=d3.mouse(this)[0],b=d3.mouse(this)[1];a>u?(A.attr("x1",a).attr("y1",j-10).attr("x2",a).attr("y2",k-30).style("display","block"),B.attr("x",a-25).attr("y",b-(h+8)/2+D).style("display","block"),C.attr("transform","translate("+a+","+(b+D)+")").text(d3.time.format("%b %d")(v.invert(a-u))).style("display","block")):(A.style("display","none"),B.style("display","none"),C.style("display","none"))}),m.on("mouseleave",function(){A.style("display","none"),B.style("display","none"),C.style("display","none")}),{sidePadding:u}};document.addEventListener("DOMContentLoaded",function(){"undefined"==typeof window.Roadmap&&e(),window.Roadmap={init:e}})}();