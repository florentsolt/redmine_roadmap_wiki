/*! roadmap.js v0.0.1 - MIT license 
2014-12-11 - Florent Solt */
!function(){var a=function(){for(var a,c=document.getElementsByClassName("roadmap"),d=0;a=c[d],"undefined"!=typeof a;d++){var e=[],f={};lines=(a.textContent||a.innerHTML||"").split("\n");for(var g,h=0;g=lines[h],h<lines.length;h++)g=g.replace(/^\s+|\s+$/g,""),f.name||f.group?f.from||f.to?""===g&&f.name&&(e.push(f),f={}):(texts=g.replace(/[^0-9\-\/]+/," ").split(" "),f.from=texts[0],f.to=texts[1]):(texts=g.split(","),f.group=texts[0],f.name=texts.slice(1).join(","));a.innerHTML="",b(a,e)}},b=function(a,b){for(var c=d3.scale.category10(),d=d3.time.format("%Y-%m-%d"),e=20,f=e+4,g=20,h=b.length*f+g+40,i=a.clientWidth,j=d3.select(a).append("svg").attr("width",i).attr("height",h).attr("style","overflow: visible"),k=d3.time.scale().clamp(!0).domain([d3.min(b,function(a){return d.parse(a.from)}),d3.max(b,function(a){var b=d.parse(a.to);return b.setHours(b.getHours()+24)})]).range([0,i-150]),l=[],m=0,n=0;n<b.length;n++){for(var o=0,p=!1;o<l.length&&!p;)p=l[o].name===b[n].group,o++;if(!p){var q=0;for(o=0;o<b.length;)b[o].group==b[n].group&&q++,o++;l.push({name:b[n].group,count:q,previous:m}),m+=q}}j.append("g").selectAll("rect").data(l).enter().append("rect").attr("rx",3).attr("ry",3).attr("x",0).attr("y",function(a){return a.previous*f+g}).attr("width",function(){return i}).attr("height",function(a){return a.count*f-4}).attr("stroke","none").attr("fill","#999").attr("fill-opacity",.1);var r=j.append("g").selectAll("text").data(l).enter().append("text").text(function(a){return a.name}).attr("x",10).attr("y",function(a){return a.count*f/2+a.previous*f+g}).attr("font-size",11).attr("text-anchor","start").attr("text-height",14).attr("fill","#000"),s=r[0].parentNode.getBBox().width+15,t=d3.svg.axis().scale(k).orient("bottom").ticks(d3.time.monday).tickSize(-h+g+40,0,0).tickFormat(d3.time.format("%b %d")),u=j.append("g").attr("transform","translate("+s+", "+(h-30)+")").call(t),v=new Date;v>k.domain()[0]&&v<k.domain()[1]&&(u.append("line").attr("x1",k(v)).attr("y1",0).attr("x2",k(v)).attr("y2",-h+g+20).attr("class","now"),u.selectAll(".now").attr("stroke","red").attr("opacity",.5).attr("stroke-dasharray","2,2").attr("shape-rendering","crispEdges")),u.selectAll("text").style("text-anchor","middle").attr("fill","#000").attr("stroke","none").attr("font-size",10).attr("dy","1em"),u.selectAll(".tick line").attr("stroke","lightgrey").attr("shape-rendering","crispEdges");var w=j.append("g").selectAll("rect").data(b).enter();w.append("rect").attr("rx",3).attr("ry",3).attr("x",function(a){return k(d.parse(a.from))+s}).attr("y",function(a,b){return b*f+g}).attr("width",function(a){var b=d.parse(a.to);return b.setHours(b.getHours()+24),k(b)-k(d.parse(a.from))}).attr("height",e).attr("stroke","none").attr("fill",function(a){for(var b=0;b<l.length;b++)if(a.group==l[b].name)return c(b)}).attr("fill-opacity",function(a){for(var c=1,d=0;d<b.length;d++){if(a==b[d])return Math.max(c,.1);a.group==b[d].group&&(c-=.3)}}),w.append("text").text(function(a){return a.name}).attr("x",function(a){return(k(d.parse(a.to))-k(d.parse(a.from)))/2+k(d.parse(a.from))+s}).attr("y",function(a,b){return b*f+14+g}).attr("font-size",11).attr("text-anchor","middle").attr("text-height",e).attr("fill","#000")};document.addEventListener("DOMContentLoaded",function(){"undefined"==typeof window.Roadmap&&a(),window.Roadmap={init:a}})}();