/*! roadmap.js v0.0.1 - MIT license 
2015-10-14 - Florent Solt */
!function(){function a(a){switch(a.type){case"people":return a.taskGroup;case"task":return a.group;case"group":return a.name}}function b(b){f(a(b),this.getBBox().y)}var c=[],d=[],e=null,f=function(a,b){if(c.length>0){e.style.minHeight=e.clientHeight+"px",e.innerHTML="",a&&(b=150>b?0:b-150,e.innerHTML="<a style='margin: 5px; margin-top: "+b+"px; display: inline-block; float: right; border-radius: 3px; color: #fff; font-size: 12px; background: #999; padding: 6px 20px 6px 20px; text-decoration: none;' href='javascript:' onclick='Roadmap.refresh()'>&larr; Back to the full roadmap</a>");var f=h(e,c.filter(function(b){return a&&b.group!==a?!1:!0}),{});d.sort(function(a,b){return a.group>b.group?1:-1}),d.length>0&&h(e,d.filter(function(b){return a&&b.taskGroup!==a?!1:!0}),f)}},g=function(){var a=d3.scale.category20();d3.selectAll("div.roadmap").each(function(){for(var b,g={},h=(this.textContent||this.innerHTML||"").split("\n"),i=0;b=h[i],i<h.length;i++){var j;if(b=b.replace(/^\s+|\s+$/g,""),g.name||g.group)if(g.from||g.to)if(""===b)""===b&&g.name&&(c.push(g),g={});else{var k,l;k=b.match(/\s+(\d+)%\s*$/),k?(l=parseInt(k[1],10),b=b.substring(0,b.length-k[0].length)):l=100,d.push({type:"people",group:b,from:g.from,to:g.to,name:g.group+" â€” "+g.name,taskGroup:g.group,color:a(g.group),involvement:l})}else j=b.replace(/[^0-9\-\/]+/," ").split(" "),g.from=j[0],g.to=j[1];else j=b.split(","),g.type="task",g.group=j[0],g.name=j.slice(1).join(","),g.color=a(g.group)}e=this,f()})},h=function(a,c,d){var e=d3.time.format("%Y-%m-%d"),f=20,g=f+4,h=20+(d.topPadding||0),i=c.length*g+40,j=a.clientWidth,k=d.svg||d3.select(a).append("svg").attr("width",j).attr("style","overflow: visible");k.attr("height",function(){return parseInt(k.attr("height")||0,10)+i}),c.sort(function(a,b){return a.group===b.group?e.parse(a.from)>e.parse(b.from)?1:-1:a.group>b.group?1:-1});for(var l=[],m=0,n=0;n<c.length;n++){for(var o=0,p=!1;o<l.length&&!p;)p=l[o].name===c[n].group,o++;if(!p){var q=0;for(o=0;o<c.length;)c[o].group===c[n].group&&q++,o++;l.push({type:"group",name:c[n].group,count:q,previous:m}),m+=q}}var r=0;for(n=0;n<c.length;n++)"people"===c[n].type&&100!==c[n].involvement&&(k.append("defs").append("pattern").attr({id:"pattern"+r,width:"8",height:"8",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}).append("rect").attr({width:Math.ceil(8*c[n].involvement/100),height:"8",transform:"translate(0,0)",fill:c[n].color,"fill-opacity":.8}),c[n].pattern="url(#pattern"+r+")",r++);k.append("g").selectAll("rect").data(l).enter().append("rect").attr("rx",3).attr("ry",3).attr("x",0).attr("y",function(a){return a.previous*g+h}).attr("width",function(){return j}).attr("height",function(a){return a.count*g-4}).attr("stroke","none").attr("fill","#999").attr("fill-opacity",.1);var s=k.append("g").selectAll("text").data(l).enter().append("text").text(function(a){return a.name}).attr("x",10).attr("y",function(a){return a.count*g/2+a.previous*g+h+2}).attr("font-size",11).attr("text-anchor","start").attr("text-height",14).attr("fill","#000"),t=d.sidePadding||s[0].parentNode.getBBox().width+15,u=d3.time.scale().clamp(!0).domain([d3.min(c,function(a){return e.parse(a.from)}),d3.max(c,function(a){var b=e.parse(a.to);return b.setHours(b.getHours()+24)})]).range([0,j-t-15]),v=d3.svg.axis().scale(u).orient("bottom").ticks(d3.time.monday).tickSize(-k.attr("height")+h+20,0,0).tickFormat(d3.time.format("%b %d")),w=k.append("g").attr("transform","translate("+t+", "+(k.attr("height")-20)+")").call(v),x=new Date;x>u.domain()[0]&&x<u.domain()[1]&&(w.append("line").attr("x1",u(x)).attr("y1",0).attr("x2",u(x)).attr("y2",-k.attr("height")+h+20).attr("class","now"),w.selectAll(".now").attr("stroke","red").attr("opacity",.5).attr("stroke-dasharray","2,2").attr("shape-rendering","crispEdges")),w.selectAll("text").style("text-anchor","middle").attr("fill","#000").attr("stroke","none").attr("font-size",10).attr("dy","1em"),w.selectAll(".tick line").attr("stroke","#dddddd").attr("shape-rendering","crispEdges");var y=k.append("g").selectAll("rect").data(c).enter();if(y.append("rect").attr("rx",3).attr("ry",3).attr("x",function(a){return u(e.parse(a.from))+t}).attr("y",function(a,b){return b*g+h}).attr("width",function(a){var b=e.parse(a.to);return b.setHours(b.getHours()+24),u(b)-u(e.parse(a.from))}).attr("height",f).attr("stroke","none").attr("fill",function(a){return a.pattern||a.color}).attr("fill-opacity",.5).on("mouseover",function(){d3.select(this).style({cursor:"pointer"})}).on("click",b),y.append("text").text(function(a){return a.name}).attr("x",function(a){return(u(e.parse(a.to))-u(e.parse(a.from)))/2+u(e.parse(a.from))+t}).attr("y",function(a,b){return b*g+14+h}).attr("font-size",11).attr("text-anchor","middle").attr("text-height",f).attr("fill","#000").style("pointer-events","none"),d.svg){var z=k.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0).style("stroke","black").style("stroke-width","1px").style("stroke-dasharray","2,2").style("shape-rendering","crispEdges").style("pointer-events","none").style("display","none"),A=k.append("rect").attr("rx",3).attr("ry",3).attr("width",50).attr("height",f).attr("stroke","none").attr("fill","black").attr("fill-opacity",.8).style("display","none"),B=k.append("text").attr("font-size",11).attr("font-weight","bold").attr("text-anchor","middle").attr("text-height",f).attr("fill","white").style("display","none"),C=40;k.on("mousemove",function(){var a=d3.mouse(this)[0],b=d3.mouse(this)[1];a>t?(z.attr("x1",a).attr("y1",10).attr("x2",a).attr("y2",k.attr("height")-20).style("display","block"),A.attr("x",a-25).attr("y",b-(f+8)/2+C).style("display","block"),B.attr("transform","translate("+a+","+(b+C)+")").text(d3.time.format("%b %d")(u.invert(a-t))).style("display","block")):(z.style("display","none"),A.style("display","none"),B.style("display","none"))}),k.on("mouseleave",function(){z.style("display","none"),A.style("display","none"),B.style("display","none")})}return{sidePadding:t,topPadding:i,svg:k}};document.addEventListener("DOMContentLoaded",function(){"undefined"==typeof window.Roadmap&&g(),window.Roadmap={parse:g,refresh:f}})}();