/*! roadmap.js v0.0.1 - MIT license 
2015-06-25 - Florent Solt */
!function(){function a(a){switch(a.type){case"people":return a.taskGroup;case"task":return a.group;case"group":return a.name}}function b(){}function c(){d3.select(this).style({cursor:"pointer"})}function d(b){var c=b?e(a(b)):window.location.hash.substr(1);b&&window.location.hash==="#"+c?(d3.selectAll(".item").style("opacity",1),window.location.hash=""):(d3.selectAll(".item").style("opacity",.2),d3.selectAll("."+c).style("opacity",1),window.location.hash=c)}function e(a){return"_"+a.toLowerCase().replace(/[^a-z0-9]+/g,function(){return"-"})}var f=function(){var a=d3.scale.category10();d3.selectAll("div.roadmap").each(function(){var b=[],c=[],d={};lines=(this.textContent||this.innerHTML||"").split("\n");for(var e,f=0;e=lines[f],f<lines.length;f++)e=e.replace(/^\s+|\s+$/g,""),d.name||d.group?d.from||d.to?""===e?""===e&&d.name&&(b.push(d),d={}):c.push({type:"people",group:e,from:d.from,to:d.to,name:d.group+" â€” "+d.name,taskGroup:d.group,color:a(d.group)}):(texts=e.replace(/[^0-9\-\/]+/," ").split(" "),d.from=texts[0],d.to=texts[1]):(texts=e.split(","),d.type="task",d.group=texts[0],d.name=texts.slice(1).join(","),d.color=a(d.group));if(b.length>0){this.innerHTML="";var h=g(this,b);c.sort(function(a,b){return a.group>b.group?1:-1}),c.length>0&&g(this,c,h+50)}})},g=function(f,g){for(var h=d3.time.format("%Y-%m-%d"),i=20,j=i+4,k=20+(k||0),l=g.length*j+k+40,m=f.clientWidth,n=d3.select(f).append("svg").attr("width",m).attr("height",l).attr("style","overflow: visible"),o=[],p=0,q=0;q<g.length;q++){for(var r=0,s=!1;r<o.length&&!s;)s=o[r].name===g[q].group,r++;if(!s){var t=0;for(r=0;r<g.length;)g[r].group==g[q].group&&t++,r++;o.push({type:"group",name:g[q].group,count:t,previous:p}),p+=t}}n.append("g").selectAll("rect").data(o).enter().append("rect").attr("rx",3).attr("ry",3).attr("x",0).attr("y",function(a){return a.previous*j+k}).attr("width",function(){return m}).attr("height",function(a){return a.count*j-4}).attr("stroke","none").attr("fill","#999").attr("fill-opacity",.1);var u=n.append("g").selectAll("text").data(o).enter().append("text").text(function(a){return a.name}).attr("x",10).attr("y",function(a){return a.count*j/2+a.previous*j+k}).attr("font-size",11).attr("text-anchor","start").attr("text-height",14).attr("fill","#000"),v=u[0].parentNode.getBBox().width+15,w=d3.time.scale().clamp(!0).domain([d3.min(g,function(a){return h.parse(a.from)}),d3.max(g,function(a){var b=h.parse(a.to);return b.setHours(b.getHours()+24)})]).range([0,m-v-15]),x=d3.svg.axis().scale(w).orient("bottom").ticks(d3.time.monday).tickSize(-l+k+20,0,0).tickFormat(d3.time.format("%b %d")),y=n.append("g").attr("transform","translate("+v+", "+(l-30)+")").call(x),z=new Date;z>w.domain()[0]&&z<w.domain()[1]&&(y.append("line").attr("x1",w(z)).attr("y1",0).attr("x2",w(z)).attr("y2",-l+k+20).attr("class","now"),y.selectAll(".now").attr("stroke","red").attr("opacity",.5).attr("stroke-dasharray","2,2").attr("shape-rendering","crispEdges")),y.selectAll("text").style("text-anchor","middle").attr("fill","#000").attr("stroke","none").attr("font-size",10).attr("dy","1em"),y.selectAll(".tick line").attr("stroke","#dddddd").attr("shape-rendering","crispEdges");var A=n.append("g").selectAll("rect").data(g).enter();return A.append("rect").attr("class",function(b){return"item "+e(a(b))}).attr("rx",3).attr("ry",3).attr("x",function(a){return w(h.parse(a.from))+v}).attr("y",function(a,b){return b*j+k}).attr("width",function(a){var b=h.parse(a.to);return b.setHours(b.getHours()+24),w(b)-w(h.parse(a.from))}).attr("height",i).attr("stroke","none").attr("fill",function(a){return a.color}).attr("fill-opacity",.5).on("mouseover",c).on("mouseout",b).on("click",d),A.append("text").attr("class",function(b){return"item "+e(a(b))}).text(function(a){return a.name}).attr("x",function(a){return(w(h.parse(a.to))-w(h.parse(a.from)))/2+w(h.parse(a.from))+v}).attr("y",function(a,b){return b*j+14+k}).attr("font-size",11).attr("text-anchor","middle").attr("text-height",i).attr("fill","#000").on("mouseover",c).on("mouseout",b).on("click",d),l};document.addEventListener("DOMContentLoaded",function(){"undefined"==typeof window.Roadmap&&(f(),""!==window.location.hash.substr(1)&&d()),window.Roadmap={init:f}})}();